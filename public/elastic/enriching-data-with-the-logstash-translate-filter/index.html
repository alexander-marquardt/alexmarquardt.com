<!DOCTYPE html>
<html lang="en" dir="auto" data-theme="light">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Enriching data with the Logstash translate filter | Alexander Marquardt</title>
<meta name="keywords" content="">
<meta name="description" content="March 6, 2020
Introduction
Logstash is an open source, server-side data processing pipeline that ingests data from a multitude of sources, transforms it, and then sends it to one or more outputs. One use of Logstash is for enriching data before sending it to Elasticsearch.
Logstash supports several different lookup plugin filters that can be used for enriching data. Many of these rely on components that are external to the Logstash pipeline for storing enrichment data. On the other hand, the translate filter plugin can be used for looking up data and enriching documents without dependencies. Therefore, in this blog article I focus on using Logstash with the translate filter plugin for enriching data.">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:1313/elastic/enriching-data-with-the-logstash-translate-filter/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.2fe4dc5b52567b7454ee976e121c74370e14415db7564bb5ae6de9bd591821ff.css" integrity="sha256-L&#43;TcW1JWe3RU7pduEhx0Nw4UQV23Vku1rm3pvVkYIf8=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/elastic/enriching-data-with-the-logstash-translate-filter/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    }

</script>
</head>
<body id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Alexander Marquardt (Alt + H)">Alexander Marquardt</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Enriching data with the Logstash translate filter
    </h1>
    <div class="post-meta"><span title='2020-03-06 00:00:00 +0000 UTC'>March 6, 2020</span>&nbsp;·&nbsp;<span>7 min</span>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#introduction" aria-label="Introduction">Introduction</a></li>
                <li>
                    <a href="#enriching-data-with-the-translate-filter-plugin" aria-label="Enriching data with the translate filter plugin">Enriching data with the translate filter plugin</a></li>
                <li>
                    <a href="#using-the-translate-plugin-combined-with-json-subdocuments" aria-label="Using the translate plugin combined with JSON subdocuments">Using the translate plugin combined with JSON subdocuments</a></li>
                <li>
                    <a href="#using-a-json-dictionary-file-with-the-translate-filter-plugin" aria-label="Using a JSON dictionary file with the translate filter plugin">Using a JSON dictionary file with the translate filter plugin</a></li>
                <li>
                    <a href="#converting-csv-to-json" aria-label="Converting CSV to JSON">Converting CSV to JSON</a></li>
                <li>
                    <a href="#alternative-approach-to-enrich-documents" aria-label="Alternative approach to enrich documents">Alternative approach to enrich documents</a></li>
                <li>
                    <a href="#conclusion" aria-label="Conclusion">Conclusion</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>March 6, 2020</p>
<h2 id="introduction">Introduction<a hidden class="anchor" aria-hidden="true" href="#introduction">#</a></h2>
<p><a href="https://www.elastic.co/logstash">Logstash</a> is an open source, server-side data processing pipeline that ingests data from a multitude of sources, transforms it, and then sends it to one or more outputs. One use of Logstash is for enriching data before sending it to Elasticsearch.</p>
<p>Logstash supports several different <a href="https://www.elastic.co/guide/en/logstash/current/lookup-enrichment.html#geoip-def">lookup plugin filters</a> that can be used for enriching data. Many of these rely on components that are external to the Logstash pipeline for storing enrichment data. On the other hand, the <a href="https://www.elastic.co/guide/en/logstash/current/plugins-filters-translate.html">translate filter plugin</a> can be used for looking up data and enriching documents without dependencies. Therefore, in this blog article I focus on using Logstash with the translate filter plugin for enriching data.</p>
<h2 id="enriching-data-with-the-translate-filter-plugin">Enriching data with the translate filter plugin<a hidden class="anchor" aria-hidden="true" href="#enriching-data-with-the-translate-filter-plugin">#</a></h2>
<p>An example Logstash pipeline that executes a translate filter lookup is given below. This filter searches in the translate dictionary for the key indicated by the value stored in the event’s “lookup_id”, and stores the value retrieved from the translate dictionary in the “enrichment_data” field. If the value from the “lookup_id” is not found in the translate dictionary, then code will store the “fallback” value of “not_found” in the “enrichment_data” field.</p>
<pre tabindex="0"><code>input {
  # The generator creates an input event
  generator {
    lines =&gt; [
     &#39;{&#34;my_msg&#34;: &#34;testing1234&#34;, &#34;lookup_id&#34;: &#34;1234&#34;}&#39;
    ]
    count =&gt; 1
    codec =&gt;  &#34;json&#34;
  }
}

filter {
  # Enrich the event using the lookup_id
  translate {
    field =&gt; &#34;[lookup_id]&#34;
    destination =&gt; &#34;[enrichment_data]&#34;
    fallback =&gt; &#34;not_found&#34;
    dictionary =&gt; {
      &#34;1234&#34; =&gt; &#34;1234 found in the dictionary&#34;
      &#34;5678&#34; =&gt; &#34;5678 also in the dictionary&#34;
    }
  }
}

output {
  stdout { codec =&gt;  &#34;rubydebug&#34; }
}
</code></pre><p>The above pipeline can be stored in a config file, and executed by running the following command:</p>
<pre tabindex="0"><code>./logstash -f &lt;logstash config file&gt;
</code></pre><p>Which should result in a document that contains a field called “enrichment_data” that was populated by the translate filter plugin, as shown below:</p>
<pre tabindex="0"><code>{
           &#34;@version&#34; =&gt; &#34;1&#34;,
    &#34;enrichment_data&#34; =&gt; &#34;1234 found in the dictionary&#34;,
         &#34;@timestamp&#34; =&gt; 2020-03-04T12:21:16.989Z,
             &#34;my_msg&#34; =&gt; &#34;testing1234&#34;,
          &#34;lookup_id&#34; =&gt; &#34;1234&#34;,
           &#34;sequence&#34; =&gt; 0,
               &#34;host&#34; =&gt; &#34;alexandersmbp2.lan&#34;
}
</code></pre><p>In the event of an unsuccessful lookup, the output should look like the following:</p>
<pre tabindex="0"><code>{
    &#34;enrichment_data&#34; =&gt; &#34;not_found&#34;,
           &#34;@version&#34; =&gt; &#34;1&#34;,
         &#34;@timestamp&#34; =&gt; 2020-03-04T12:35:02.791Z,
               &#34;host&#34; =&gt; &#34;alexandersmbp2.lan&#34;,
           &#34;sequence&#34; =&gt; 0,
             &#34;my_msg&#34; =&gt; &#34;testing1234&#34;,
          &#34;lookup_id&#34; =&gt; &#34;1234x&#34;
}
</code></pre><h2 id="using-the-translate-plugin-combined-with-json-subdocuments">Using the translate plugin combined with JSON subdocuments<a hidden class="anchor" aria-hidden="true" href="#using-the-translate-plugin-combined-with-json-subdocuments">#</a></h2>
<p>While the above approach is useful for simple key-value lookups, it may sometimes be necessary to enrich documents with more complex lookups. This can be achieved by embedding JSON subdocuments directly in the translate filter. Such a pipeline could look as follows:</p>
<pre tabindex="0"><code>input {
  # The generator creates an input event
  generator {
    lines =&gt; [
     &#39;{&#34;my_msg&#34;: &#34;testing123&#34;, &#34;lookup_id&#34;: &#34;1234&#34;}&#39;
    ]
    count =&gt; 1
    codec =&gt;  &#34;json&#34;
  }
}

filter {
  # Enrich the event using the lookup_id
  translate {
    field =&gt; &#34;[lookup_id]&#34;
    destination =&gt; &#34;[enrichment_data]&#34;
    fallback =&gt; &#39;{&#34;key1&#34;:&#34;not_found&#34;}&#39;
    dictionary =&gt; {
      &#34;1234&#34; =&gt; {&#34;key1&#34; =&gt; &#34;first 1&#34; &#34;key2&#34; =&gt; 123 &#34;key3&#34; =&gt; &#34;third 1&#34;}
      &#34;5678&#34; =&gt; {&#34;key1&#34; =&gt; &#34;first 2&#34; &#34;key2&#34; =&gt; 456 &#34;key3&#34; =&gt; &#34;third 2&#34;}
    }
  }

  # Failed lookup - ensure JSON is stored
  if [enrichment_data] ==&#39;{&#34;key1&#34;:&#34;not_found&#34;}&#39; {
    json { 
      source =&gt; &#34;enrichment_data&#34; 
      target =&gt; &#34;enrichment_data&#34;
    }
  }
}

output {
  stdout { codec =&gt;  &#34;rubydebug&#34; }
}
</code></pre><p>Note that in the above pipeline, because a “fallback” value can only contain a string, additional processing is done to ensure that failed lookups store an object in “enrichment_data”.</p>
<p>In the event of a successful lookup, the output should look as follows:</p>
<pre tabindex="0"><code>{
          &#34;lookup_id&#34; =&gt; &#34;1234&#34;,
           &#34;@version&#34; =&gt; &#34;1&#34;,
    &#34;enrichment_data&#34; =&gt; {
        &#34;key1&#34; =&gt; &#34;first 1&#34;,
        &#34;key3&#34; =&gt; &#34;third 1&#34;,
        &#34;key2&#34; =&gt; 123
    },
         &#34;@timestamp&#34; =&gt; 2020-03-04T12:19:53.612Z,
           &#34;sequence&#34; =&gt; 0,
             &#34;my_msg&#34; =&gt; &#34;testing123&#34;,
               &#34;host&#34; =&gt; &#34;alexandersmbp2.lan&#34;
}
</code></pre><p>And in the event of an unsuccessful lookup, the output should look like the following:</p>
<pre tabindex="0"><code>{
    &#34;enrichment_data&#34; =&gt; {
        &#34;key1&#34; =&gt; &#34;not_found&#34;
    },
             &#34;my_msg&#34; =&gt; &#34;testing123&#34;,
         &#34;@timestamp&#34; =&gt; 2020-03-04T12:19:17.742Z,
           &#34;@version&#34; =&gt; &#34;1&#34;,
               &#34;host&#34; =&gt; &#34;alexandersmbp2.lan&#34;,
          &#34;lookup_id&#34; =&gt; &#34;1234x&#34;,
           &#34;sequence&#34; =&gt; 0
}
</code></pre><h2 id="using-a-json-dictionary-file-with-the-translate-filter-plugin">Using a JSON dictionary file with the translate filter plugin<a hidden class="anchor" aria-hidden="true" href="#using-a-json-dictionary-file-with-the-translate-filter-plugin">#</a></h2>
<p>The translate filter plugin supports large dictionaries, and has been tested with up to 100,000 key/values. For large dictionaries it may be convenient to store the <a href="https://www.elastic.co/guide/en/logstash/current/plugins-filters-translate.html#plugins-filters-translate-dictionary_path">lookup values in an external file</a> rather than directly in the Logstash pipeline.</p>
<p>When using a JSON dictionary, it is possible to provide multi-valued dictionary values in an external JSON dictionary file that would look like the following:</p>
<pre tabindex="0"><code>{
  &#34;1234&#34;:{&#34;key1&#34;:&#34;first 1&#34;, &#34;key2&#34;:123, &#34;key3&#34;:&#34;third 1&#34;},
  &#34;5678&#34;:{&#34;key1&#34;:&#34;first 2&#34;, &#34;key2&#34;:456, &#34;key3&#34;:&#34;third 2&#34;}
}
</code></pre><p>And a Logstash pipeline that uses this JSON dictionary file is as follows:</p>
<pre tabindex="0"><code>input {
  # The generator creates an input event
  generator {
    lines =&gt; [
     &#39;{&#34;my_msg&#34;: &#34;testing123&#34;, &#34;lookup_id&#34;: &#34;1234&#34;}&#39;
    ]
    count =&gt; 1
    codec =&gt;  &#34;json&#34;
  }
}

filter {
  # Enrich the event using the lookup_id
  translate {
    field =&gt; &#34;[lookup_id]&#34;
    destination =&gt; &#34;[enrichment_data]&#34;
    fallback =&gt; &#39;{&#34;key1&#34;:&#34;not_found&#34;}&#39;

    # ** Must set &#34;/path/to/lookup.json&#34; to your lookup file **
    dictionary_path =&gt; &#34;/path/to/lookup.json&#34;
  }

  # Failed lookup - ensure JSON is stored
  if [enrichment_data] == &#39;{&#34;key1&#34;:&#34;not_found&#34;}&#39; {
    json { 
      source =&gt; &#34;enrichment_data&#34; 
      target =&gt; &#34;enrichment_data&#34;
    }
  }
}

output {
  stdout { codec =&gt;  &#34;rubydebug&#34; }
}
</code></pre><p>Note that in the above pipeline, because a “fallback” value can only contain a string, additional processing is done to ensure that failed lookups store an object in “enrichment_data”.   The output from this example pipeline should be the same as the previous example.</p>
<h2 id="converting-csv-to-json">Converting CSV to JSON<a hidden class="anchor" aria-hidden="true" href="#converting-csv-to-json">#</a></h2>
<p>In some cases, data that is to be used for enriching documents is available in CSV files such as those that may be produced by Microsoft Excel. However, the translate filter plugin expects exactly two columns when used with CSV data. Therefore, in order to support multi-value lookups, multi-column CSV must be converted into a different format that supports more complex enrichments. One such format is JSON. Therefore, in this section we present a Python 3 script that can convert a CSV table into a JSON document that is suitable for the translate filter.</p>
<p>Given a CSV file that looks as follows:</p>
<pre tabindex="0"><code>lookup_id,key1,key2,key3
&#34;1234&#34;,&#34;first 1&#34;,123,&#34;third 1&#34;
&#34;5678&#34;,&#34;first 2&#34;,456,&#34;third 2&#34;
</code></pre><p>The script will generate an output file that is suitable for use by the translate plugin. The generated file will look as follows:</p>
<pre tabindex="0"><code>{
  &#34;1234&#34;:{&#34;key1&#34;:&#34;first 1&#34;, &#34;key2&#34;:123, &#34;key3&#34;:&#34;third 1&#34;},
  &#34;5678&#34;:{&#34;key1&#34;:&#34;first 2&#34;, &#34;key2&#34;:456, &#34;key3&#34;:&#34;third 2&#34;}
}
</code></pre><p>The source code for the Python script that creates the JSON from the CSV can be <a href="https://github.com/alexander-marquardt/csv-to-json-for-logstash">found on github</a> and is also given below:</p>
<pre tabindex="0"><code>#!/usr/bin/env python

# This is written with python3 syntax

import csv
import os
import json

INPUT_FILE_NAME = &#39;lookup.csv&#39;
INPUT_FILE_PATH = os.path.join(os.getcwd(), INPUT_FILE_NAME)
CSV_DELIMITER = &#39;,&#39;

OUTPUT_FILE_NAME = &#39;lookup.json&#39;
OUTPUT_FILE_PATH = os.path.join(os.getcwd(), OUTPUT_FILE_NAME)

LOOKUP_COL = &#34;lookup_id&#34;

# Each CSV line will be converted into a dictionary object, and pushed
# onto an array. This ensures that the generated json
# will have the same order as the lines in the CSV file.
array_of_ordered_dict = []

# function to convert the CSV into an array that contains a json-like
# dictionary for each line in the CSV file
def create_ordered_dict_from_input():
    with open(INPUT_FILE_PATH) as csv_file:
        csv_reader = csv.DictReader(csv_file, delimiter=CSV_DELIMITER)
        print(&#34;Reading %s&#34; % INPUT_FILE_PATH)
        for row in csv_reader:
            array_of_ordered_dict.append(row)

        print(&#34;Finished reading %s&#34; % INPUT_FILE_PATH)
        return array_of_ordered_dict;

# Convert the array of dictionary objects into a json object.
def convert_array_of_ordered_dict_to_json(array_of_ordered_dict):

    print(&#34;Creating %s&#34; % OUTPUT_FILE_PATH)
    f = open(OUTPUT_FILE_PATH, &#34;w&#34;)

    # Create the json lookup table
    f.write(&#34;{\n&#34;)

    arr_len = len(array_of_ordered_dict)
    for idx, row in enumerate(array_of_ordered_dict):
        lookup_id = row[LOOKUP_COL]
        del row[LOOKUP_COL]

        # lookup_id is a dictionary key, with the json_dict as the value
        json_element = &#39;&#34;{0}&#34; : {1}&#39;.format(lookup_id, json.dumps(row))

        # If this is the last json element, then the dictionary should be closed rather than
        # adding a trailing comma.
        json_line = &#39;&#39;.join([json_element, &#34;\n}\n&#34;]) if (idx+1) == arr_len else &#39;&#39;.join([json_element, &#34;,\n&#34;])

        f.write(json_line)

    print(&#34;Finished writing %s&#34; % OUTPUT_FILE_PATH)
    return 0

if __name__ == &#34;__main__&#34;:
    array_of_ordered_dict = create_ordered_dict_from_input()
    convert_array_of_ordered_dict_to_json(array_of_ordered_dict)
</code></pre><h2 id="alternative-approach-to-enrich-documents">Alternative approach to enrich documents<a hidden class="anchor" aria-hidden="true" href="#alternative-approach-to-enrich-documents">#</a></h2>
<p>Enrichment can also be achieved with the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/master/ingest-enriching-data.html">enrich processor</a> which runs in an Elasticsearch <a href="https://www.elastic.co/guide/en/elasticsearch/reference/master/ingest.html">ingest node</a>. The blog titled <a href="https://www.elastic.co/blog/should-i-use-logstash-or-elasticsearch-ingest-nodes">Should I use Logstash or Elasticsearch ingest nodes</a> may help decide which is the appropriate choice.</p>
<h2 id="conclusion">Conclusion<a hidden class="anchor" aria-hidden="true" href="#conclusion">#</a></h2>
<p>In this blog post I have showed how Logstash can use the translate filter plugin to lookup data for enriching documents. I then showed several different methods of how to populate the translate filter lookup dictionaries. Finally, I presented a script that can be used to convert CSV data into a format that can be used directly by the translate filter plugin.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">Alexander Marquardt</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu');
    if (menu) {
        
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        const html = document.querySelector("html");
        if (html.dataset.theme === "dark") {
            html.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            html.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>

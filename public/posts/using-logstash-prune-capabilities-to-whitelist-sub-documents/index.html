<!DOCTYPE html>
<html lang="en" dir="auto" data-theme="light">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Using Logstash prune capabilities to whitelist sub-documents | Alexander Marquardt</title>
<meta name="keywords" content="etl, logstash">
<meta name="description" content="Overview
Logstash&rsquo;s prune filter plugin can make use of whitelists to ensure that only specific desired fields are output from Logstash, and that all other fields are dropped. In this blog post we demonstrate the use of Logstash to whitelist desired fields and desired sub-documents before indexing into Elasticsearch.
Example input file
As an input to Logstash, we use a CSV file that contains stock market trades. A few example CSV stock market trades are given below. ">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:1313/posts/using-logstash-prune-capabilities-to-whitelist-sub-documents/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.343cc480b9ffc8f04ccbe5e968ad674880cab773ec19905e93033065c1e7a804.css" integrity="sha256-NDzEgLn/yPBMy&#43;XpaK1nSIDKt3PsGZBekwMwZcHnqAQ=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/using-logstash-prune-capabilities-to-whitelist-sub-documents/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    }

</script>
</head>
<body id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Alexander Marquardt (Alt + H)">Alexander Marquardt</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Using Logstash prune capabilities to whitelist sub-documents
    </h1>
    <div class="post-meta"><span title='2018-08-28 00:00:00 +0000 UTC'>August 28, 2018</span>&nbsp;·&nbsp;<span>3 min</span>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#overview" aria-label="Overview">Overview</a></li>
                <li>
                    <a href="#example-input-file" aria-label="Example input file">Example input file</a></li>
                <li>
                    <a href="#example-logstash-pipeline" aria-label="Example Logstash pipeline">Example Logstash pipeline</a></li>
                <li>
                    <a href="#testing-the-logstash-pipeline" aria-label="Testing the logstash pipeline">Testing the logstash pipeline</a></li>
                <li>
                    <a href="#conclusion" aria-label="Conclusion">Conclusion</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="overview">Overview<a hidden class="anchor" aria-hidden="true" href="#overview">#</a></h1>
<p>Logstash&rsquo;s <a href="https://www.elastic.co/guide/en/logstash/current/plugins-filters-prune.html">prune filter plugin</a> can make use of whitelists to ensure that only specific desired fields are output from Logstash, and that all other fields are dropped. In this blog post we demonstrate the use of Logstash to whitelist desired fields and desired sub-documents before indexing into Elasticsearch.</p>
<h1 id="example-input-file">Example input file<a hidden class="anchor" aria-hidden="true" href="#example-input-file">#</a></h1>
<p>As an input to Logstash, we use a CSV file that contains stock market trades. A few example CSV stock market trades are given below. </p>
<pre tabindex="0"><code>1483230600,1628.75,1678.1,1772.8,2443.6
1483232400,1613.63,1688.5,1750.5,2460.2
1483234200,1606.51,1678.6,1718,2448.2
1483236000,1621.04,1684.1,1708.1,2470.4
</code></pre><p>The comma separated values represent  &ldquo;time&rdquo;, &ldquo;DAX&rdquo;, &ldquo;SMI&rdquo;, &ldquo;CAC&rdquo;, &ldquo;FTSE&rdquo; . You may wish to copy and paste the above lines into a CSV file called stocks.csv in order to execute the example command line given later in this blogpost. </p>
<h1 id="example-logstash-pipeline">Example Logstash pipeline<a hidden class="anchor" aria-hidden="true" href="#example-logstash-pipeline">#</a></h1>
<p>Below is a Logstash pipeline which can be stored in a file called &lsquo;stocks.conf&rsquo;, that does the following:</p>
<ol>
<li>Reads stock market trades as CSV-formatted input from stdin.</li>
<li>Maps each row of the CSV input to a JSON document, where the CSV columns map to JSON fields.</li>
<li>Converts the time field to Unix format.</li>
<li>Moves DAX and CAC fields into a nested structure called &ldquo;my_nest&rdquo;.</li>
<li>Whitelists the &ldquo;my_nest&rdquo; field (which contains a sub-document) and the &ldquo;SMI&rdquo; field so that all other (non-whitelisted) fields will be removed.</li>
<li>Writes the resulting documents to an Elasticsearch index called &ldquo;stocks_whitelist_test&rdquo;.</li>
</ol>
<pre tabindex="0"><code># For this simple example, pipe in data from stdin. 
input {
    stdin {}
}

filter {
    csv {
        columns =&gt; [&#34;time&#34;,&#34;DAX&#34;,&#34;SMI&#34;,&#34;CAC&#34;,&#34;FTSE&#34;]
        separator =&gt; &#34;,&#34;
        convert =&gt; { &#39;DAX&#39; =&gt; &#39;float&#39;
        &#39;SMI&#39; =&gt; &#39;float&#39;
        &#39;CAC&#39; =&gt; &#39;float&#39;
        &#39;FTSE&#39; =&gt; &#39;float&#39;}
    }
    date {
        match =&gt; [&#39;time&#39;, &#39;UNIX&#39;]
    }
    mutate {
        # Move DAX and CAC into a sub-document 
        # called &#39;my_nest&#39;
        rename =&gt; {
            &#34;DAX&#34; =&gt; &#34;[my_nest][DAX]&#34;
            &#34;CAC&#34; =&gt; &#34;[my_nest][CAC]&#34;
        }
    }
     
    # Remove everything except &#34;SMI&#34; and the 
    # &#34;my_nest&#34; sub-document 
    prune {
         whitelist_names =&gt; [ &#34;SMI&#34;, &#34;my_nest&#34; ]
    }
}

output {
    stdout { codec =&gt; dots }
    elasticsearch {
        index =&gt; &#34;stocks_whitelist_test&#34;
    }
}
</code></pre><h1 id="testing-the-logstash-pipeline">Testing the logstash pipeline<a hidden class="anchor" aria-hidden="true" href="#testing-the-logstash-pipeline">#</a></h1>
<p>To test this pipeline with the example CSV data, you could execute something similar to the following command, modifying it to ensure that you use paths that are correct for your system:</p>
<pre tabindex="0"><code>cat ./stocks.csv | ./logstash -f ./stocks.conf
</code></pre><p>You can the check the data that you have stored in Elasticsearch by executing the following comand from Kibana&rsquo;s dev console:</p>
<pre tabindex="0"><code>GET /stocks_whitelist_test/_search
</code></pre><p>Which should display documents with the following structure:</p>
<pre tabindex="0"><code>      {
        &#34;_index&#34;: &#34;stocks_whitelist_test&#34;,
        &#34;_type&#34;: &#34;doc&#34;,
        &#34;_id&#34;: &#34;KANygWUBsYalOV9yOKsD&#34;,
        &#34;_score&#34;: 1,
        &#34;_source&#34;: {
          &#34;my_nest&#34;: {
            &#34;CAC&#34;: 1718,
            &#34;DAX&#34;: 1606.51
          },
          &#34;SMI&#34;: 1678.6
        }
      }
</code></pre><p>Notice that only &ldquo;my_nest&rdquo; and &ldquo;SMI&rdquo; have been indexed as indicated by the contents of the document&rsquo;s &ldquo;_source&rdquo;. Also note that the &ldquo;FTSE&rdquo; and &ldquo;time&rdquo; fields have been removed as they were not in the prune filter&rsquo;s whitelist.</p>
<h1 id="conclusion">Conclusion<a hidden class="anchor" aria-hidden="true" href="#conclusion">#</a></h1>
<p>In this blog post, we have demonstrated how Logstash’s <a href="https://www.elastic.co/guide/en/logstash/current/plugins-filters-prune.html">prune filter plugin</a> can make use of whitelists to ensure that only specific desired fields are output from Logstash.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/etl/">Etl</a></li>
      <li><a href="http://localhost:1313/tags/logstash/">Logstash</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/posts/using-logstash-to-drive-filtered-data-from-a-single-source-into-multiple-output-destinations/">
    <span class="title">« Prev</span>
    <br>
    <span>Using Logstash to drive filtered data from a single source into multiple output destinations</span>
  </a>
  <a class="next" href="http://localhost:1313/posts/deduplicating-documents-in-elasticsearch/">
    <span class="title">Next »</span>
    <br>
    <span>Deduplicating documents in Elasticsearch</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">Alexander Marquardt</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu');
    if (menu) {
        
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        const html = document.querySelector("html");
        if (html.dataset.theme === "dark") {
            html.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            html.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
